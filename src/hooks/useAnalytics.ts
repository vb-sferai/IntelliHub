import { useEffect } from 'react';
import { useLocation } from 'react-router';
import {
  saveUTMParams,
  trackPageView,
  getSavedUTMParams,
} from '../utils/analytics';

/**
 * –•—É–∫ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞ UTM-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
 *
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
 * - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç UTM-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ
 * - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
 * - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É
 */
export function useAnalytics() {
  const location = useLocation();

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Å–æ—Ö—Ä–∞–Ω—è–µ–º UTM –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ
  useEffect(() => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    const existing = getSavedUTMParams();

    if (!existing) {
      // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞—Ö–æ–¥ –≤ —Å–µ—Å—Å–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è–µ–º UTM
      const params = saveUTMParams();

      if (params) {
        console.log('üéØ UTM-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', params);
      }
    } else {
      console.log('üìå –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ UTM:', existing);
    }
  }, []); // –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

  // –¢—Ä–µ–∫–∏–Ω–≥ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
  useEffect(() => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å UTM-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    trackPageView(location.pathname + location.search);
  }, [location]); // –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ URL

  return {
    getUTMParams: getSavedUTMParams,
  };
}
